---
title: Graceful Shutdown
description: Graceful Shutdown의 필요성은 무엇이 있을까요?
date: 2026-02-12
tags: [Graceful Shutdown]
---

Graceful Shutdown(우하한 종료)은 서버나 애플리케이션을 종료할 때, 강제로 전원을 끄는 것이 아니라 “하던 작업은 마저 끝내고, 정리 정돈을 마친 뒤에 종료하는 것”을 의미합니다.

마치 퇴근할 때 컴퓨터 전원 코드를 확 뽑아버리는 것(Hard Shutdown)과, 진행 중인 문서를 저장하고 프로그램을 닫은 뒤 ‘시스템 종료’를 누르는 것(Graceful Shutdown)의 차이입니다.

현대적인 서버 환경, 특히 클라우드 및 마이크로서비스 환경에서는 배포나 오토스케일링으로 인해 서버가 수시로 켜지고 꺼지기 때문에 이 기능이 필수적입니다.

## 1. 데이터 정합성 유지

서버가 클라이언트의 요청을 처리하는 도중에 강제로 종료되면, 데이터 손실이나 오염이 발생할 수 있습니다.

- 상황: 사용자가 결제를 진행 중인데, 결제 승인은 났지만 DB에 ‘주문 완료’를 기록하기 직전에 서버가 뚝 꺼졌습니다.
- 결과 (Hard Shutdown): 돈은 나갔는데 주문 내역은 없는 심각한 데이터 불일치가 발생합니다.
- 결과 (Graceful Shutdown): 종료 신호를 받으면, 새로운 요청은 거절하되 이미 처리 중인 결제 로직은 끝까지 완료하고 종료하므로 데이터가 안전합니다.

## 2. 사용자 경험 (UX) 보호

서비스 배포를 위해 서버를 재시작하는 상황을 가정해 봅시다.

- 상황: 사용자가 게시글을 열심히 작성하고 ‘등록’ 버튼을 눌렀습니다. 하필 그때 배포가 진행되어 서버가 재시작됩니다.
- 결과 (Hard Shutdown): 사용자는 502 Bad Gateway 에러나 Connection Refused 오류를 보게되고, 작성한 글은 날아갑니다.
- 결과 (Graceful Shutdown): 서버는 ‘종료 예정’ 상태가 되더라도, 사용자의 ‘등록’ 요청까지는 정상적으로 처리해서 응답(200OK)을 보내준 뒤에 내려갑니다. 사용자는 서버가 재시작된 줄도 모르게 서비스를 이용할 수 있습니다.

## 3. 리소스 정리 및 누수 방지

애플리케이션은 실행 중에 데이터베이스 연결(Connection), 파일 핸들, 네트워크 소켓 등 다양한 리소스를 점유하고 있습니다.

- 문제: 강제 종료되면 이 리소스들이 제대로 반환되지 않을 수 있습니다.
- 구체적 예시
  - DB 커넥션: 종료 시 커넥션을 끊어주지 않으면, DB 서버 입장에서는 “얘가 아직 살아있나?”하고 불필요한 세션을 유지하느라 자원을 낭비하게 됩니다.
  - 로그팡칠: 로그를 파일에 기록 중이었다면, 마지막 줄이 잘리거나 파일이 깨질 수 있습니다.

## Graceful Shutdown의 동작 과정

보통 운영체제나 오케스트레이터(Kubernetes)는 다음과 같은 순서로 종료를 유도합니다.

1. 종료 신호 전송: “이제 곧 꺼질 거니까 준비해”라는 신호를 보냅니다.
2. 새로운 요청 차단: 애플리케이션은 이 신호를 받으면 로드 밸런서 등에서 자신을 제외시키고, 더 이상 새로운 요청을 받지 않습니다.
3. 진행 중인 작업 완료: 이미 큐에 들어와 있거나 처리 중인 스레드들이 작업을 마칠 때까지 일정 시간 기다려줍니다.
4. 리소스 정리: DB 연결 종료, 파일 닫기, 쓰레드 풀 종료 등을 수행합니다.
5. 최종 종료: 애플리케이션이 스스로 종료하거나, 시간이 초과되면 강제종료 당합니다.

## 정리

Graceful Shutdown은 “뒷정리를 깔끔하게 하고 나가는 매너”입니다. 이것이 없으면 잦은 배포나 스케일링 과정에서 데이터가 깨지고, 사용자 요청이 유실되며, 시스템 자원이 낭비되는 문제가 발생합니다. 따라서 실무에서는 Spring Boot 설정이나 Kubernetes 설정을 통해 반드시 적용해야 하는 기능입니다.
