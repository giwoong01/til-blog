---
title: 엔티티 매니저란?
description: 엔티티 매니저는 무엇이고 어떤 역할을 가지고 있나요?
date: 2025-10-30
tags: [Spring Boot, JPA, EntityManager, 영속성 컨텍스트]
---

# 엔티티 매니저(EntityManager)란?

EntityManager는 JPA에서 엔티티 객체를 관리하고 DB와의 상호작용을 담당하는 핵심 인터페이스입니다.

애플리케이션 코드와 실제 데이터베이스 사이에서 중간 관리자 역할을 합니다.

쉽게 말하면.. JPA에서 DB를 직접 다루지 않고, 엔티티 매니저를 통해서 엔티티 단위로 데이터를 다루게 하는 객체라고 볼 수 있습니다.

# 엔티티 매니저의 주요 역할

| 역할                       | 설명                                                                               |
| -------------------------- | ---------------------------------------------------------------------------------- |
| 엔티티 생명주기 관리       | 엔티티 객체의 상태 (비영속 → 영속 → 준영속 → 삭제)를 관리                          |
| CRUD 수행                  | persist(), find(), merge(), remove() 등의 메소드를 통해 DB 작업 수행               |
| 트랜잭션 관리              | 엔티티 매니저는 트랜잭션 단위로 작동하며, commit 시점에 실제 SQL이 실행됨          |
| 변경 감지 (Dirty Checking) | 영속성 컨텍스트 내의 엔티티가 변경되면, 트랜잭션 종료 시 자동으로 update 쿼리 발생 |
| 1차 캐시 관리              | 동일 트랜잭션 내에서 조회된 엔티티를 캐싱하여 중복 SQL 호출 방지                   |

# 엔티티 매니저와 영속성 컨텍스트(Persistence Context)

EntityManager는 내부적으로 영속성 컨텍스트(Persistence Context)라는 저장소를 가집니다.

- 영속성 컨텍스트는 “엔티티를 관리하는 1차 캐시”입니다.
- 엔티티 매니저를 통해 persist() 하면 객체가 여기에 저장되고, DB와 동기화 상태가 유지됩니다.

```java
EntityManager em = entityManagerFactory.createEntityManager();
em.getTransaction().begin();

Member member = new Member("woong");
em.persist(member); // 영속 상태 (1차 캐시에 저장됨)

em.getTransaction().commit(); // flush → DB 반영
em.close();
```

엔티티 매니저 = 영속성 컨텍스트를 제어하는 조종자입니다.

(실제로 EntityManager가 영속성 컨텍스트를 “직접 소유”하지 않고 “위임”받는 구조이긴 하지만, JPA 개발자 입장에서는 거의 동일하게 봐도 무방)

# 엔티티 생명주기와 관련성

| 상태                   | 설명                                    | 전환 메소드                |
| ---------------------- | --------------------------------------- | -------------------------- |
| 비영속 (new/transient) | JPA가 모르는 상태                       | new 키워드로 객체 생성 시  |
| 영속 (managed)         | JPA가 관리하는 상태 (1차 캐시에 등록됨) | persist() 호출 시          |
| 준영속 (detached)      | 더 이상 관리되지 않음                   | detach(), clear(), close() |
| 삭제 (remove)          | 삭제 예약 상태                          | remove() 호출시            |

# 엔티티 매니저 팩토리(Entity Manager Factory)란?

엔티티 매니저 팩토리는 엔티티 매니저를 생성하는 책임을 가진 객체입니다. 스프링 부트 애플리케이션에서 엔티티 매니저를 필요로 할 때, 엔티티 매니저 팩토리가 이를 생성하여 제공하게 됩니다.

엔티티 매니저 팩토리는 애플리케이션에서 한 번만 생성되고, 이를 통해 여러 엔티티 매니저 인스턴스를 생성할 수 있습니다. 이 팩토리는 데이터베이스와의 연결 정보를 가지고 있으며, 영속성 유닛이라고 불리는 설정 단위를 기반으로 엔티티 매니저를 관리합니다.

## 동작 원리

스프링 부트는 애플리케이션이 시작될 때 엔티티 매니저 팩토리를 자동으로 구성하고, 필요한 영속성 유닛을 설정합니다. 이 과정에서 데이터베이스 연결 정보, 캐싱 설정 트랜잭션 관리 등 다양한 설정이 적용됩니다.

![image.png](/images/til/2025-10-30-4/1.png)

# Spring Data JPA에서의 EntityManager

Spring Data JPA에서는 개발자가 직접 EntityManager를 생성하지 않고, 스프링이 자동으로 주입해주는 프록시 객체를 사용됩니다.

```java
@Repository
public class MemberRepository {
    @PersistenceContext
    private EntityManager em;

    public void save(Member member) {
        em.persist(member);
    }
}
```

스프링은 트랜잭션 범위마다 새로운 영속성 컨텍스트를 바인딩해주기 때문에, 개발자가 엔티티 매니저를 직접 관리할 필요가 없습니다.

# !! 중요한 점

### 엔티티 매니저는 쓰레드 세이프하지 않다.

요청마다 새로운 트랜잭션과 함께 EntityManager가 생성되므로, 싱글톤으로 공유하면 안됩니다.

### 트랜잭션 범위가 곧 영속성 컨텍스트의 생명주기

@Transactional 시작 시 영속성 컨텍스트 생성, 커밋 시 flush → SQL 실행, 이후 close 됩니다.

### JPQL 실행 시 flush가 자동으로 발생

JPQL은 DB 상태를 직접 조회하기 때문에, 그 전에 변경사항을 flush하여 동기화합니다.

# 정리

EntityManager는 엔티티를 관리하고, 영속성 컨텍스트를 통해 DB와 동기화하는 핵심 객체입니다.

트랜잭션 단위로 생성되어 1차 캐시, 변경 감지, 지연 쓰기 등 JPA의 기능을 제공하며, 스프링 환경에서는 @PersistenceContext를 통해 안전하게 주입받아 사용합니다.
