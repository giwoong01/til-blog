---
title: CORS (Cross-Origin Resource Sharing)
description: CORS란 무엇일까요?
date: 2025-12-01
tags: [CORS, SOP]
---

CORS (Cross-Origin Resource Sharing, 교차 출처 리소스 공유)는 웹 브라우저가 보안을 위해 기본적으로 차단하고 있는 다른 출처(Origin) 간의 리소스 요청을, 서버가 허용할 수 있도록 해주는 표준 메커니즘입니다.

웹 생태계의 가장 기본적인 보안 원칙인 동일 출처 정책(SOP)과 그 예외 상황을 처리하는 방식입니다.

## 동일 출처 정책 (SOP, Same-Origin Policy)

CORS를 이해하려면 먼저 SOP를 알아야 합니다.

- 정의
  - 웹 브라우저는 보안상의 이유로 스크립트에서 시작한 HTTP 요청이 ‘자신과 동일한 출처’인 경우에만 데이터를 읽을 수 있도록 허용합니다.
- 출처(Origin)란? 다음 세 가지가 모두 같아야 동일 출처입니다.
  - 프로토콜: http vs https
  - 호스트: naver.com vs google.com (또는 localhost)
  - 포트: 80 vs 8080
- 예시
  - http://localhost:3000
  - http://localhost:8080
  - 이 둘은 포트 번호가 다르므로 다른 출처입니다. 따라서 브라우저는 기본적으로 통신을 차단합니다.

## CORS의 동작 원리

CORS는 브라우저와 서버 간의 헤더 교환을 통해 이루어지는 협약입니다. 브라우저는 다른 출처로 요청을 보낼 때 HTTP 헤더에 자신의 출처를 담아서 보내고, 서버는 응답 헤더에 허용된 출처를 담아서 보냅니다.

### 핵심 헤더

- 요청 헤더 (Browser → Server): Origin: http://localhost:3000
- 응답 헤더 (Server → Browser): Access_Control-Allow-Origin: http://localhost:3000 (또는 \*)

브라우저는 서버가 보낸 Access-Control-Allow-Oriign 헤더를 확인하고, 자신이 보낸 Origin과 일치하면 데이터를 JavaScript에 전달하고, 그렇지 않으면 CORS 에러를 발생시키고 데이터를 폐기합니다.

## CORS 요청의 두 가지 시나리오

CORS 요청은 안전성에 따라 두 가지 방식으로 동작합니다.

### A. 단순 요청 (Simple Request)

기존 데이터에 부작용을 일으키지 않는 안전한 요청으로 간주될 때 발생합니다.

- 조건
  - 메소드: `GET`, `HEAD`, `POST`
  - 헤더: `Accept`, `Accept-Language`, `Content-Language`, `Content-Type` (일부만 허용)
  - `Content-Type`: `application/x-www-urlencoded`, `multipart/form-data`, `text/plain` 만 허용
- 동작
  - 예비 요청 없이 바로 본 요청을 보냅니다.

### B. 예비 요청 (Preflight Request)

대부분의 모던 웹 애플리케이션(REST API 등)에서 발생하는 시나리오입니다. 서버에 데이터를 변경할 수 있거나(JSON 전송 등), 사용자 정의 헤더가 포함된 경우 브라우저는 안전 확인 절차를 거칩니다.

1. OPTIONS 요청 (Preflight): 브라우저가 실제 요청을 보내기 전에, OPTIONS 메소드로 서버에 “나 이 요청 보내도 돼?”라고 물어봅니다.
   - `Access-Control-Request-Method: POST`
   - `Access-Control-Request-Headers: Authorization, Content-Type`
2. 서버 승인: 서버가 허용한다는 응답을 보냅니다.
   - `Access-Control-Allow-Origin: http://localhost:3000`
   - `Access-Control-Allow-Methods: GET, POST, OPTIONS`
3. 본 요청: 승인을 확인한 브라우저가 비로소 실제 POST 요청을 보냅니다.

## 주의사항 및 해결 방법

CORS 에러는 브라우저가 내는 에러입니다. 서버 로그에는 요청이 정상적으로 처리되었다고 나올 수 있습니다.(200OK) 하지만 브라우저가 응답 헤더를 보고 “너는 권한이 없어”라며 데이터를 가려버린 것입니다.

### 해결 방법 (Spring Boot 예시)

서버 측에서 응답 헤더에서 Access-Control-Allow-Origin을 내려주도록 설정해야 합니다.

1. 전역 설정 (WebConfig.java)

   ```java
   @Configuration
   public class WebConfig implements WebMvcConfigurer {
       @Override
       public void addCorsMappings(CorsRegistry registry) {
           registry.addMapping("/**")
                   .allowedOrigins("http://localhost:3000") // 허용할 출처
                   .allowedMethods("GET", "POST", "PUT", "DELETE");
       }
   }
   ```

1. 컨트롤러별 설정 (@CrossOrigin)

   ```java
   @RestController
   @CrossOrigin(origins = "http://localhost:3000")
   public class MemberController { ... }
   ```

## 정리

CORS는 보안(SOP)과 편의성(리소스 공유) 사이의 균형을 맞추기 위한 표준입니다.

- 누가 막는가? 브라우저 (서버는 응답을 주지만 브라우작 버림)
- 어떻게 푸는가? 서버가 응답 헤더를 통해 브라우저에게 “이 출처는 믿어도 돼”라고 허락해 줘야함.
