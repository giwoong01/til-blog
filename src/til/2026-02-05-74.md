---
title: 스프링 트랜잭션 AOP
description: 스프링 트랜잭션 AOP 동작 흐름에 대해서
date: 2026-02-05
tags: [스프링 트랜잭션 AOP]
---

스프링의 @Transactional 어노테이션이 작동하는 핵심은 바로 AOP(Aspect Oriented Programming)와 프록시(Proxy) 패턴입니다.

사용자가 서비스 메소드를 호출할 때, 실제로는 진짜 객체가 아닌 가짜 객체가 먼저 호출되어 트랜잭션을 시작하고 끝내는 역할을 수행합니다.

## 1. 전체적인 구조 (프록시 패턴)

스프링 컨테이너가 초기화될 때, @Transactional이 붙은 빈 (Bean)을 발견하면 프록시 객체를 생성해서 빈으로 등록합니다. 외부에서 이 서비스를 주입(DI)받으면, 실제 서비스가 아니라 이 프록시 객체를 주입받게 됩니다.

## 2. 단계별 동작 흐름

1. Caller의 호출 (요청 진입)

    외부(예: Controller)에서 서비스 메소드(doSomething())를 호출합니다. 이때 호출되는 것은 프록시 객체입니다.

1. 트랜잭션 시작

    프록시 내부에는 트랜잭션 인터셉터가 있습니다. 가장 먼저 가로챕니다.

    - 트랜잭션 매니저 호출: PlatformTransactionManager에게 “트랜잭션 하나 만들어줘”라고 요청합니다.
    - 커넥션 획득: 트랜잭션 매니저는 DataSource에서 DB 커넥션을 가져옵니다.
    - AutoCommit 끄기: con.setAutoCommit(false)를 설정하여 수동 커넥션 모드로 전환합니다. (이게 트랜잭션의 시작입니다.)
    - 동기화 매니저 등록: 가져온 커넥션을 TransactionSynchronizationManager(ThreadLocal)에 저장합니다. 이제부터 쓰레드에서 일어나는 모든 DB 작업은 이 커넥션을 공유해서 씁니다.

1. 실제 비즈니스 로직 수행

    준비가 다 되면, 프록시는 실제 대상 객체의 메소드를 호출합니다.

    - 비즈니스 로직이 수행되면서 SQL을 실행합니다.
    - 이때 SQL은 ThreadLocal에 보관된 커넥션을 꺼내서 사용하므로, 하나의 트랜잭션으로 묶이게 됩니다.

1. 결과에 따른 처리 (Commit / Rollback)

    Target 메소드가 리턴되면 제어권이 다시 프록시(인터셉터)로 넘어옵니다.

    - 성공 시 (정상 리턴)
        - 인터셉터는 트랜잭션 매니저에게 커밋을 요청합니다. (con.commit())
    - 실패 시 (예외 발생)
        - Unchecked Exception (RuntimeException, Error): 기본적으로 롤백을 수행합니다. (con.rollback())
        - Checked Exception (Exception): 기본적으로는 커밋합니다. (개발자가 rollbackFor 옵션으로 설정하지 않는 경우)

1. 트랜잭션 종료 및 정리
    - 리소스 정리: ThreadLocal에 있던 커넥션을 제거합니다.
    - 커넥션 반납: con.setAutoCommit(true)로 되돌리고 커넥션을 풀에 반납합니다.

## 3. 주의사항

AOP 프록시 방식이기 때문에 발생하는 두 가지 제약이 있습니다.

1. 프라이빗 메소드(private)에는 적용 불가
    - 프록시는 타겟 클래스를 상속받거나 인터페이스를 구현해서 만듭니다. private 메소드는 자식이나 외부에서 접근할 수 없으므로 오버라이딩이 안 되어 AOP가 적용되지 않습니다.
2. 자기 호출 문제
    - 같은 클래스 내부의 메소드끼리 호출할 때, 프록시를 거치지 않고 직접 내부 메소드를 호출하게 됩니다.
    - 이 경우, 내부 메소드에서 @Transactional이 있어도 트랜잭션 기능이 동작하지 않습니다.

## 정리

“프록시가 문지기처럼 앞 뒤를 감싸고 있다”고 생각하면 쉽습니다.

1. 문 열기: 프록시가 커넥션을 따고, setAutoCommit(false) (트랜잭션 시작)
2. 일하기: 실제 서비스 코드 실행
3. 문 닫기: 문제없으면 commit, 에러 나면 rollback 후 커넥션 반납
