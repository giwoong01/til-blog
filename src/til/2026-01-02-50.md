---
title: CAP 정리
description: CAP 정리는 무엇인가요?
date: 2026-01-02
tags: [CAP]
---

CAP 정리는 분산 데이터베이스 시스템을 설계할 때, 세 가지 속성 중 두 가지만 가질 수 있다는 이론입니다.

분산 시스템 설계의 가장 기초가 되는 원칙입니다.

## 1. CAP의 3가지 요소

### Consistency (일관성)

- “모든 노드가 같은 시간에 같은 데이터를 보여줘여 한다.”
- 사용자가 데이터를 쓰기 완료한 후, 어떤 노드에서 읽기를 수행하더라도 항상 최신 데이터를 반환해야 합니다.
- 만약 최신 데이터를 반환할 수 없다면 에러를 내야 합니다.
- 주의: ACID의 일관성과는 다릅니다. ACID는 데이터 무결성 규칙을 의미하지만, CAP는 데이터 동기화를 의미합니다.

### Availability (가용성)

- “모든 요청은 정상적인 응답을 받아야 한다.”
- 특정 노드가 죽거나 문제가 생겨도, 살아있는 노드는 사용자 요청에 대해 에러 없이 응답해야 합니다.
- 단, 그 응답이 반드시 최신 데이터일 필요는 없습니다. (일관성 포기)

### Partition Tolerance (분할 내성)

- “네트워크가 단절되어 메시지가 손실되더라도 시스템은 동작해야 한다.”
- 물리적으로 떨어진 서버 간의 네트워크 연결이 끊어지더라도 서비스가 계속되어야 함을 의미합니다.

## 2. 현실적인 선택: 3가지를 다 가질 수 없는 이유

분산 시스템 환경(네트워크를 타는 환경)에서는 Partition Tolerance(P)는 선택이 아니라 필수 입니다. 네트워크 장애는 언제든 발생할 수 있기 때문입니다.

따라서 개발자는 네트워크 장애가 발생했을 때, 일관성(C)을 선택할지 가용성(A)을 선택할지 결정해야 합니다. 이를 두고 CP 시스템과 AP 시스템으로 나눕니다. (CA 시스템은 분산 환경에서 사실상 불가능합니다.)

## 3. CP vs AP

### CP 시스템

- 전락: “데이터가 안 맞을 바에는 차라리 응답을 하지 않겠다.”
- 동작: 네트워크 단절이 발생하여 데이터 동기화가 불가능행지면, 데이터 불일치를 막기 위해 쓰기/읽기 요청을 거부(에러 반환)하거나 타임아웃을 발생시킵니다.
- 특징: 완벽한 데이터 정합성이 중요한 금융권 시스템 등에 적합합니다.
- 예시
  - MongoDB, HBase, Redis (기본 설정 시)
  - 은행의 계좌 이체 시스템

### AP 전략

- 전략: “데이터가 좀 틀려도 일단 응답을 주겠다.”
- 동작: 네트워크 단절로 동기화가 안 되더라도, 각 노드는 자신이 가진 데이터를 바탕으로 일단 응답합니다. 나중에 네트워크가 복구되면 그때 데이터를 맞춥니다. (최종 일관성)
- 특징: SNS 피드, 쇼핑몰 장바구니처럼 약간의 데이터 오차가 있어도 서비스가 멈추지 않는 것이 중요한 경우에 적합합니다.
- 예시
  - Cassandra, DynamoDB, Couchbase
  - DNS 서버

## 4. PACELC 정리

CAP 정리는 “네트워크 장애가 났을 때(P)”의 선택만을 다룹니다. 하지만 평상시의 성능 문제도 고려해야 한다는 비판이 있어 PACELC 정리가 등장했습니다.해

> Partition 상황에서는 A와 C 중 하나를 선택하고 (CAP), Else (정상 상황)에서는 Latency(지연 시간)와 Consistency(일관성) 중 하나를 선택한다.

- 설명
  - 정상적인 상황에서도 데이터를 완벽하게 동기화하려면(C), 모든 노드에 데이터를 복제하는 시간이 걸려 응답 속도(L)가 느려집니다. 반대로 응답 속도(L)를 빠르게 하려면 비동기 복제를 해야 하므로 일관성(C)이 순간적으로 깨질 수 있습니다.

## 정리

- CAP: 분산 시스템은 일관성(C), 가용성(A), 분할 내성(P) 중 2가지만 가질 수 있습니다.
- 현실: P(분할 내성)는 무조건 안고 가야 하므로, CP(정합성 중시)냐 AP(가용성 중시)냐를 선택하는 싸움입니다.
